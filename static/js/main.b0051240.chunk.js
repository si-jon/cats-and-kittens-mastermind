(this["webpackJsonpxstate-react-typescript-template"]=this["webpackJsonpxstate-react-typescript-template"]||[]).push([[0],{32:function(t,e,n){},43:function(t,e,n){"use strict";n.r(e);var o=n(29),r=n(5),i=(n(32),n(9),n(26)),a=n(23),s=n(2),c=n(46),u=n(47),p=n(21);function l(t){return Object(s.q)((function(e){return{type:"SPEAK",value:t}}))}function d(){return Object(s.q)("LISTEN")}var g=n(11).a.cancel,m=Object(s.q)("TIMER",{delay:3e4,id:"repromptTimer"}),y=g("repromptTimer"),E=Object(s.b)({repromptCount:function(t){return 0}});function h(t,e){return{initial:"reprompt",states:{repromptCounter:{entry:[Object(s.q)("STOP_LISTEN"),Object(s.b)({repromptCount:function(t){return t.repromptCount+1}})],always:[{cond:function(t){return t.repromptCount>5},target:"done"},{target:"reprompt"}]},reprompt:{entry:l(t),on:{ENDSPEECH:e},exit:m},done:{type:"final"}}}}var f={zero:{digit:"0"},one:{digit:"1"},two:{digit:"2"},three:{digit:"3"},four:{digit:"4"},for:{digit:"4"},five:{digit:"5"},six:{digit:"6"},seven:{digit:"7"},eight:{digit:"8"},nine:{digit:"9"}},b={yes:!0,"you bet":!0,yeah:!0,no:!1,"no way":!1,nope:!1},O={initial:"pre",states:{pre:{entry:l("Cats and kittens is a version of the game Mastermind.     Your task is to figure out my four digit code with help of my hints."),on:{ENDSPEECH:"mid"}},mid:{entry:l("You guess which four digits, 0-9, are in my code, and I'll give you a hint of each guess.        The hints are the number of cats and kittens!"),on:{ENDSPEECH:"cat"}},cat:{entry:l("A cat indicates one of the numbers in your guess are in the correct spot."),on:{ENDSPEECH:"kitten"}},kitten:{entry:l("A kitten indicates one of the numbers in your guess are included in the code, but in the wrong spot."),on:{ENDSPEECH:"done"}},done:{type:"final"}}},j=Object(s.q)((function(t){return{type:"QUERY",value:t.recResult}}));function S(){for(var t=[],e=0;e<4;e++)t.push(Math.floor(10*Math.random()));return t}function R(t){var e=t.split(" ");e.forEach((function(t,e,n){void 0!=f[t]&&"digit"in f[t]&&(n[e]=f[t].digit||"")}));var n=e.join("").replace(/[^0-9]/g,"");return Array.from(n)}function v(t){return R(t).length}function N(t){return 4==v(t)&&function(t){var e=R(t);for(var n in e){var o=Number(e[n]);if(isNaN(o))return!1}return!0}(t)}function k(t){var e=R(t),n=[];for(var o in e){var r=Number(e[o]);n.push(r)}return n}function C(t,e,n,o){t.guessHistory.push({guess:e,catCount:n,kittenCount:o})}function w(t){for(var e=0,n=0,o=Object(p.a)(t.digits),r=Object(p.a)(t.digitsResponse),i=Object(p.a)(o),a=r,s=0;s<4;s++)r[s]==o[s]&&(e+=1,i[s]=NaN,a[s]=NaN);for(var c=0;c<4;c++)if(!isNaN(a[c]))for(var u=0;u<4;u++)isNaN(i[u])||a[c]!=i[u]||(n+=1,a[c]=NaN,i[u]=NaN);C(t,t.digitsResponse.join(""),e,n)}function D(t){w(t);var e=t.guessHistory.length-1,n=0,o=0;e>=0&&(n=t.guessHistory[e].catCount,o=t.guessHistory[e].kittenCount);var r=1==n?"cat":"cats",i=1==o?"kitten":"kittens";return"".concat(n," ").concat(r,", ").concat(o," ").concat(i)}function P(t){w(t);var e=t.guessHistory.length;return"Meow meow meow meow! Purrfect! You got it in ".concat(e," tries!")}var x=Object(s.b)((function(t){return{digitsResponse:k(t.recResult)}})),H={initial:"catsnkittens",entry:[E,Object(s.b)({guessHistory:function(t){return[]}})],states:{catsnkittens:{id:"catsnkittens",initial:"welcome",states:{welcome:{entry:[Object(s.b)((function(t){return{digits:S()}})),l("Let's play cats and kittens!")],on:{ENDSPEECH:"play"}},play:{id:"play",initial:"prompt",states:{prompt:{entry:l("Give me four digits!"),on:{ENDSPEECH:"ask"},exit:m},ask:{entry:d(),exit:y},reprompt:Object(r.a)(Object(r.a)({},h("You can ask me for help if you need to.","#play.ask")),{},{onDone:"#done"}),result:{entry:[Object(s.q)((function(t){return{type:"SPEAK",value:D(t)}}))],on:{ENDSPEECH:"prompt"}},tooMany:{entry:[function(t){return C(t,t.digitsResponse.join(""),0,0)},l("That's too many digits")],on:{ENDSPEECH:"prompt"}},tooFew:{entry:[function(t){return C(t,t.digitsResponse.join(""),0,0)},l("That's too few digits")],on:{ENDSPEECH:"prompt"}},invalid:{entry:[function(t){return C(t,"<not digits>",0,0)},l("That's not four digits")],on:{ENDSPEECH:"prompt"}}},on:{TIMER:".reprompt.repromptCounter",RECOGNISED:[{cond:function(t){return"help"===t.recResult},target:"#helpgame"},{cond:function(t){return"quit"===t.recResult},target:"#quitgame"},{cond:function(t){return function(t,e){for(var n=k(e),o=0;o<4;o++)if(n[o]!=t[o])return!1;return!0}(t.digits,t.recResult)},actions:x,target:"finished"},{cond:function(t){return N(t.recResult)},actions:x,target:".result"},{cond:function(t){return v(t.recResult)>4},actions:x,target:".tooMany"},{cond:function(t){return v(t.recResult)<4&&v(t.recResult)>0},actions:x,target:".tooFew"},{target:".invalid"}]}},finished:{entry:[Object(s.q)((function(t){return{type:"SPEAK",value:P(t)}}))],on:{ENDSPEECH:"#playprompt"}},gamehist:{type:"history",history:"shallow"}}},playprompt:{id:"playprompt",initial:"prompt",states:{prompt:{entry:l("Do you want to play again?"),on:{ENDSPEECH:"ask"},exit:m},ask:{entry:d(),exit:y},reprompt:Object(r.a)(Object(r.a)({},h("Play again?","#playprompt.ask")),{},{onDone:"#done"})},on:{TIMER:".reprompt.repromptCounter",RECOGNISED:[{cond:function(t){return!0===b[t.recResult]},actions:[Object(s.b)({guessHistory:function(t){return[]}})],target:"catsnkittens"},{cond:function(t){return!1===b[t.recResult]},target:"done"},{target:".prompt"}]}},common:{id:"common",states:{help:{id:"helpgame",initial:"prompt",states:{prompt:{entry:l("Do you want to know the rules of the game, quit the game, or continue playing?"),on:{ENDSPEECH:"ask"},exit:m},ask:{entry:d(),exit:y},howToPlayInGame:Object(r.a)(Object(r.a)({},O),{},{onDone:{target:"#catsnkittens.gamehist"}}),reprompt:Object(r.a)(Object(r.a)({},h("Do you want to know the rules of the game, quit the game, or continue playing?","#helpgame.ask")),{},{onDone:"#done"}),nomatch:{entry:l("Sorry, I don't know how to do this."),on:{ENDSPEECH:"prompt"}},pending:{id:"pending",on:{RESPONSE:[{cond:function(t,e){return"continue"===e.value},target:"#catsnkittens.gamehist"},{cond:function(t,e){return"quit"===e.value},target:"#quitgame"},{cond:function(t,e){return"how_to_play"===e.value},target:"howToPlayInGame"},{target:"nomatch"}],RESPONSE_ERROR:{target:"#error"}}}},on:{TIMER:".reprompt.repromptCounter",RECOGNISED:{actions:j,target:".pending"}}},quitgame:{id:"quitgame",initial:"prompt",states:{prompt:{entry:l("Are you sure you want to quit?"),on:{ENDSPEECH:"ask"},exit:m},ask:{entry:d(),exit:y},reprompt:Object(r.a)(Object(r.a)({},h("Do you want to exit the game?","#quitgame.ask")),{},{onDone:"#done"})},on:{TIMER:".reprompt.repromptCounter",RECOGNISED:[{cond:function(t){return!0===b[t.recResult]},target:"#done"},{cond:function(t){return!1===b[t.recResult]},target:"#catsnkittens.gamehist"},{target:".prompt"}]}}}},done:{id:"done",entry:l("Bye bye!"),type:"final"}}},q=Object(s.q)((function(t){return{type:"QUERY",value:t.recResult}})),I={id:"main",initial:"init",states:{init:{on:{CLICK:"welcome"}},welcome:{initial:"prompt",states:{prompt:{entry:l("Welcome to cats and kittens!"),on:{ENDSPEECH:"#intro"}}}},intro:{id:"intro",initial:"prompt",states:{prompt:{entry:l("Let's play! Or I can give you some options on what to do!"),on:{ENDSPEECH:"ask"},exit:m},ask:{entry:d(),exit:y},reprompt:Object(r.a)(Object(r.a)({},h("I can give you some options on what to do, if you need to!","#intro.ask")),{},{onDone:"#done"}),nomatch:{entry:l("Sorry, I don't know how to do this."),on:{ENDSPEECH:"prompt"}},pending:{id:"pending",on:{RESPONSE:[{cond:function(t,e){return"play_game"===e.value},target:"#dmMastermind"},{cond:function(t,e){return"quit"===e.value},target:"#quit"},{cond:function(t,e){return"how_to_play"===e.value},target:"#howToPlay"},{cond:function(t,e){return"options"===e.value},target:"#options"},{cond:function(t,e){return"help"===e.value},target:"#help"},{target:"nomatch"}],RESPONSE_ERROR:{target:"#error"}}}},on:{TIMER:".reprompt.repromptCounter",RECOGNISED:{actions:q,target:".pending"}}},quit:{id:"quit",initial:"prompt",states:{prompt:{entry:l("Are you sure you want to quit?"),on:{ENDSPEECH:"ask"},exit:m},ask:{id:"ask",entry:d(),exit:y},reprompt:Object(r.a)(Object(r.a)({},h("Do you want to quit?","#quit.ask")),{},{onDone:"#done"}),nomatch:{entry:l("Sorry, I didn't catch that."),on:{ENDSPEECH:"prompt"}},pending:{id:"pending",on:{RESPONSE:[{cond:function(t,e){return"affirm"===e.value},target:"#done"},{cond:function(t,e){return"deny"===e.value},target:"#intro"},{target:"nomatch"}],RESPONSE_ERROR:{target:"#error"}}}},on:{TIMER:".reprompt.repromptCounter",RECOGNISED:{actions:q,target:".pending"}}},howToPlay:Object(r.a)(Object(r.a)({id:"howToPlay"},O),{},{onDone:{target:"intro"}}),options:{id:"options",initial:"prompt",states:{prompt:{entry:l("These are your options. Play the game. Ask for the rules. Or exit the game."),on:{ENDSPEECH:"#intro"}}}},help:{id:"help",initial:"prompt",states:{prompt:{entry:l("If you don't know what to do, you can ask for options."),on:{ENDSPEECH:"#intro"}}}},dmMastermind:Object(r.a)(Object(r.a)({id:"dmMastermind"},H),{},{onDone:{target:"init"}}),error:{id:"error",entry:l("Sorry, something went wrong. Maybe try again later?"),on:{ENDSPEECH:"done"}},done:{id:"done",entry:l("Bye bye!"),type:"final"}},onDone:{target:".init"}},T={initial:"init",states:{init:{on:{QUERY:{actions:Object(s.b)((function(t,e){return{query:e.value}})),target:"query"}}},query:{invoke:{src:function(t,e){return n=t.query,fetch(new Request("https://cors-anywhere.herokuapp.com/https://cnk-mastermind-rasa-server.herokuapp.com/model/parse",{method:"POST",headers:{Origin:"https://github.com/si-jon/cats-and-kittens-mastermind"},body:'{"text": "'.concat(n,'"}')})).then((function(t){return t.json()}));var n},onDone:{target:"init",actions:[Object(s.q)((function(t,e){return{type:"RESPONSE",value:e.data.intent.name}})),function(t,e){return console.log(e.data)}]},onError:{target:"init",actions:[Object(s.q)((function(t,e){return{type:"RESPONSE_ERROR",value:e.data}})),function(t,e){return console.log(e.data)}]}}}}},M=n(25),A=n(8);Object(u.a)({url:"https://statecharts.io/inspect",iframe:!1});var L=Object(a.a)({id:"root",type:"parallel",context:{recResult:"",nluData:"",ttsAgenda:"",query:"",digits:[],digitsResponse:[],guessHistory:[],repromptCount:0},states:{dm:Object(r.a)({},I),dmRasaQuery:Object(r.a)({},T),asrtts:{initial:"idle",states:{idle:{on:{LISTEN:"recognising",SPEAK:{target:"speaking",actions:Object(s.b)((function(t,e){return{ttsAgenda:e.value}}))}}},recognising:{initial:"progress",entry:"recStart",exit:"recStop",on:{ASRRESULT:{actions:["recLogResult",Object(s.b)((function(t,e){return{recResult:e.value}}))],target:".match"},RECOGNISED:"idle",STOP_LISTEN:"idle"},states:{progress:{},match:{entry:Object(s.q)("RECOGNISED")}}},speaking:{entry:"ttsStart",on:{ENDSPEECH:"idle"}}}}}},{actions:{recLogResult:function(t){console.log("<< ASR: "+t.recResult)},test:function(){console.log("test")},logIntent:function(t){console.log("<< NLU intent: "+t.nluData.intent.name)}}}),G=function(t){switch(!0){case t.state.matches({asrtts:"recognising"}):return Object(A.jsx)("button",Object(r.a)(Object(r.a)({type:"button",className:"glow-on-hover",style:{animation:"glowing 20s linear"}},t),{},{children:"Listening..."}));case t.state.matches({asrtts:"speaking"}):return Object(A.jsx)("button",Object(r.a)(Object(r.a)({type:"button",className:"glow-on-hover",style:{animation:"bordering 1s infinite"}},t),{},{children:"Speaking..."}));case t.state.matches({dmRasaQuery:"query"}):return console.log("Waiting for rasa result"),Object(A.jsx)("button",Object(r.a)(Object(r.a)({type:"button",className:"glow-on-hover",style:{animation:"glowing 60s linear"}},t),{},{children:"Waiting..."}));default:return Object(A.jsx)("button",Object(r.a)(Object(r.a)({type:"button",className:"glow-on-hover"},t),{},{children:"Click to start"}))}},_=function(t){var e=t.state.context.guessHistory.map((function(t,e){var n=t.guess,o=t.catCount,r=t.kittenCount;return Object(A.jsxs)("li",{children:[Object(A.jsx)("div",{className:"guess",children:n}),Object(A.jsxs)("div",{className:"hint",children:["\ud83d\udc31: ",o," \ud83d\udc08: ",r]})]},e)}));return Object(A.jsx)("ol",{className:"guessList",children:e})},K=function(t){var e=t.state.context.guessHistory,n=e.length-1;return n>=0&&4===e[n].catCount?Object(A.jsx)("div",{className:"winMessage",children:"\ud83d\ude38 \ud83d\ude38 \ud83d\ude38 \ud83d\ude38 Purrrrfect!"}):Object(A.jsx)("div",{})};function Y(){var t=Object(M.useSpeechSynthesis)({onEnd:function(){l("ENDSPEECH")}}),e=t.speak,n=t.cancel,r=(t.speaking,Object(M.useSpeechRecognition)({onResult:function(t){l({type:"ASRRESULT",value:t})}})),i=r.listen,a=(r.listening,r.stop),s=Object(c.b)(L,{devTools:!0,actions:{recStart:Object(c.a)((function(){console.log("Ready to receive speech input."),i({interimResults:!1,continuous:!0})})),recStop:Object(c.a)((function(){console.log("Recognition stopped."),a()})),ttsStart:Object(c.a)((function(t,n){console.log("Speaking..."),e({text:t.ttsAgenda})})),ttsCancel:Object(c.a)((function(t,e){console.log("TTS STOP..."),n()}))}}),u=Object(o.a)(s,3),p=u[0],l=u[1];u[2];return Object(A.jsx)("div",{className:"background",children:Object(A.jsxs)("div",{className:"Game",children:[Object(A.jsx)("h1",{children:"\ud83d\udc31 Cats & Kittens! \ud83d\udc08"}),Object(A.jsx)(G,{state:p,onClick:function(){return l("CLICK")}}),Object(A.jsx)("div",{id:"lined",children:Object(A.jsxs)("div",{id:"content",children:[Object(A.jsx)(_,{state:p}),Object(A.jsx)(K,{state:p})]})})]})})}i.render(Object(A.jsx)(Y,{}),document.getElementById("root"))}},[[43,1,2]]]);
//# sourceMappingURL=main.b0051240.chunk.js.map